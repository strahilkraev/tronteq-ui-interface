<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="basic_layout.css" />
    <style type="text/css"></style>
  </head>
  <script type="text/javascript" src="basic_jscript.js"></script>
  <script type="text/javascript" src="js/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="js/utils.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      reloadInfo();
      autoRefreshFn({ fn: reloadInfo });
    });

    function reloadInfo() {
      console.log("reloadInfo");
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get id open api"}',
        function (data, status) {
          $("#dev_descr").text(data.description);
          $("#part_no").text(data["part number"]);
          $("#serial").text(data.sn);
          $("#mgm_mac").text(data["mgmt mac"]);
          $("#sw_boot").text(data["sw version"]);
          $("#cfg_name").text(data["configname"]);
        }
      );

      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get info"}',
        function (data, status) {
          $("#SysName").text(data.name);
          $("#Description").text(data.description);
          $("#Location").text(data.location);
          $("#Contact").text(data.contact);
        }
      );

      $.post(
        "/api",
        '{"service":"system","access":"get","command":"slots"}',
        function (data, status) {
          if (data.booted == "system0") {
            $("#sw_alt").text(data.system1);
          } else {
            $("#sw_alt").text(data.system0);
          }
        }
      );

      // Get configuration status
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"has unsaved changes"}',
        function (data, status) {
          if (data.changes) {
            $("#cfg_status").text("unsaved changes");
          } else {
            $("#cfg_status").text("saved");
          }
        }
      );

      // Get files list
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"files"}',
        function (data, status) {
          renderFilesList(data);
        }
      );
    }

    function renderFilesList(data) {
      var tbody = document.getElementById("files_list_body");
      tbody.innerHTML = ""; // Clear existing content

      if (data?.files && data.files.length > 0) {
        for (var i = 0; i < data.files.length; i++) {
          var file = data.files[i];
          var row = document.createElement("tr");
          row.className = "table_row_content";
          row.style.fontSize = "80%";

          var nameCell = document.createElement("td");
          nameCell.style.overflow = "hidden";
          nameCell.textContent = file.name;

          var sizeCell = document.createElement("td");
          sizeCell.style.textAlign = "center";
          sizeCell.style.overflow = "hidden";
          sizeCell.style.textAlign = "right";
          var sizeStr = file.size + " B";
          if (file.size >= 1024 * 1024) {
            sizeStr = ((file.size / (1024 * 1024)) >> 0) + " MB";
          } else if (file.size >= 1024) {
            sizeStr = ((file.size / 1024) >> 0) + " KB";
          }
          sizeCell.textContent = sizeStr;

          var urlCell = document.createElement("td");
          urlCell.style.textAlign = "center";
          urlCell.style.overflow = "hidden";
          urlCell.textContent = file.url ?? "N/A";

          row.appendChild(nameCell);
          row.appendChild(sizeCell);
          row.appendChild(urlCell);
          tbody.appendChild(row);
        }
      } else {
        var row = document.createElement("tr");
        row.className = "table_row_content";
        row.style.fontSize = "80%";

        var noFilesCell = document.createElement("td");
        noFilesCell.colSpan = 3;
        noFilesCell.style.textAlign = "center";
        noFilesCell.textContent = "No files found";

        row.appendChild(noFilesCell);
        tbody.appendChild(row);
      }
    }
  </script>
  <body
    style="
      height: 100%;
      width: 100%;
      float: left;
      margin: 0px;
      font-family: Verdana;
      overflow: hidden;
      position: absolute;
    "
  >
    <div id="content" style="height: 100%; overflow: auto; width: 100%">
      <h2 style="margin-left: 10px">Status &gt; System</h2>
      <div class="box2" style="width: calc(75% - 20px)">
        <div class="box_content">
          <table style="width: 100%; table-layout: fixed">
            <col />
            <col />
            <tr>
              <td colspan="2"><a class="headline">System Info</a></td>
            </tr>
            <tr class="table_row_head" style="font-size: 80%">
              <td>Info</td>
              <td>Value</td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Hostname</td>
              <td id="SysName" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Serial number</td>
              <td id="serial" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Management MAC</td>
              <td id="mgm_mac" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Part No.</td>
              <td id="part_no" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Device Description</td>
              <td id="dev_descr" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Software Version of Booted Partition</td>
              <td id="sw_boot" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Software Version of Alternate Partition</td>
              <td id="sw_alt" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Configuration Name</td>
              <td id="cfg_name" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>Configuration Status</td>
              <td id="cfg_status" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>User-defined Description</td>
              <td id="Description" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>User-defined Location</td>
              <td id="Location" style="overflow: hidden"></td>
            </tr>
            <tr class="table_row_content" style="font-size: 80%">
              <td>User-defined Contact</td>
              <td id="Contact" style="overflow: hidden"></td>
            </tr>
          </table>
        </div>
      </div>

      <div class="box2" style="width: calc(75% - 20px); margin-top: 20px">
        <div class="box_content">
          <table style="width: 100%; table-layout: fixed">
            <col />
            <col />
            <col />
            <tr>
              <td colspan="3"><a class="headline">Files List</a></td>
            </tr>
            <tr class="table_row_head" style="font-size: 80%">
              <td>Name</td>
              <td>Size</td>
              <td>URL</td>
            </tr>
            <tbody id="files_list_body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
