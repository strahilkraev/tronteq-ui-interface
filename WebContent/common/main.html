<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="basic_layout.css" />
    <style type="text/css"></style>
  </head>
  <script type="text/javascript" src="basic_jscript.js"></script>
  <script type="text/javascript" src="js/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="js/utils.js"></script>
  <script type="text/javascript">
    function logout() {
      var ii = { service: "user", access: "get", command: "logout" };
      $.post("/api", JSON.stringify(ii), function (data, status) {
        //if(status == "success")
        {
          //window.top.location.href=  window.top.location.protocol + "//" + window.top.location.host + "/2/main.html";
          window.top.location.href = "login.html";
        }
      });
    }

    function saveChanges() {
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get config name"}',
        function (data, status) {
          var cfgName = prompt(
            "Please enter the config name (1-28 chars):",
            data.cfgName.substring(0, data.cfgName.lastIndexOf("."))
          );
          if (cfgName == null || cfgName.trim() == "") {
            // abort
          } else {
            if (cfgName.endsWith(".cfg")) {
              cfgName = cfgName.substr(0, cfgName.length - 4);
            }
            var obj = {
              service: "system",
              access: "set",
              command: "save config with name",
              parameters: {},
            };
            if (cfgName.length > 255)
              obj["parameters"].cfgName = cfgName.substr(0, 255);
            else obj["parameters"].cfgName = cfgName;
            $.post("/api", JSON.stringify(obj), function (data, status) {
              checkedChanges();
            });
          }
        }
      );
    }

    function unsavedChanges(data, status) {
      if (data.changes) {
        var st =
          '<input type="button" value="Save Changes" onclick="saveChanges()" style="background-color: #ff0000; color: white; font-weight: bold; border: 2px solid #cc0000; padding: 5px 10px; border-radius: 3px;">';
        $("#unsaved_changes")[0].innerHTML = st;
      } else {
        $("#unsaved_changes")[0].innerHTML = "no changes";
      }
    }

    function checkedChanges() {
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"has unsaved changes","sessionKeepAlive":false}',
        unsavedChanges
      );
      getCfgName();
      getUptime();
      getSysInfo();
      getSupplyInfo();
    }

    function getdevicenumbers(data) {
      if (data["cfg number"]) {
        $("#system_staus_bar_devCFGNOH").append("<b>CFG No.:</b>");
        $("#system_staus_bar_devCFGNOB").text(data["cfg number"]);
      }
    }

    function getIdCallback(data) {
      $("#system_staus_bar_serial_nr").text(data.sn);
      $("#system_staus_bar_firmware").text(data["sw version"]);
      $("#system_staus_bar_mac").text(data["mgmt mac"]);
      $("#system_staus_bar_device").text(data["part number"]);

      if (data["poe"]) {
        // add PoE to menu
        $(
          '<a class="subpoint menu-content-item" id="m_poe" onclick="navto(this);">PoE</a>'
        ).insertAfter("#Traffic");
        $(
          '<a class="subpoint menu-content-item" id="poe" onclick="navto(this);">PoE</a>'
        ).insertBefore("#ntp");
      }
    }

    $(document).ready(function () {
      setupPortInfo(setupDone);
    });

    function setupDone() {
      $("#logout").click(logout);
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get id"}',
        getIdCallback
      );
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"devicenumbers"}',
        getdevicenumbers
      );

      getUptime();
      getSysInfo();
      getSupplyInfo();
      getCfgName();
      getIgnitionStatus();
      getCurrentUser(); // Get current user information
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"has unsaved changes"}',
        unsavedChanges
      );
      autoRefreshFn({ fn: checkedChanges });
    }

    function navto(event) {
      var jj = document.getElementsByClassName("selsubpoint");
      jj[0].className = "subpoint menu-content-item";
      event.className = "selsubpoint menu-content-item";
      var iframe = document.getElementById("content_iframe");
      if (iframe) iframe.src = event.id + ".html";
    }

    function getUptimeCallback(data) {
      document.getElementById("system_staus_bar_uptime").textContent =
        data.uptime;
    }

    function getUptime() {
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get uptime"}',
        getUptimeCallback
      );
    }

    function getCfgName() {
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get config name"}',
        function (data, status) {
          document.getElementById("system_status_bar_cfg_name").textContent =
            data.cfgName;
        }
      );
    }

    function getSysInfoCallback(data) {
      document.getElementById("system_staus_bar_location").textContent =
        data.location;
    }

    function getIgnitionStatus() {
      $.post(
        "/api",
        '{"service":"ignition","access":"get","command":"status"}',
        function (data) {
          var status = "disabled";
          if (data["V2Active"]) {
            if (data["timer"] && data["timer"] > 0) {
              status = "timer (" + data["timer"] + "s)";
            } else {
              status = "active";
            }
          }
          document.getElementById(
            "system_staus_bar_ignition_status"
          ).textContent = status;
        }
      );
    }

    function getSysInfo() {
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get info"}',
        getSysInfoCallback
      );
    }

    function getSupplyCallback(data) {
      if (data.v1 && data.v2)
        document.getElementById("system_staus_bar_power").textContent =
          "V1 + V2";
      else if (data.v1)
        document.getElementById("system_staus_bar_power").textContent = "V1";
      else if (data.v2)
        document.getElementById("system_staus_bar_power").textContent = "V2";
    }

    function getSupplyInfo() {
      $.post(
        "/api",
        '{"service":"system","access":"get","command":"get supply"}',
        getSupplyCallback
      );
    }

    // Menu collapse/expand functionality
    function toggleMenuSection(sectionName) {
      var content = document.getElementById(sectionName + "-content");
      var arrow = document.getElementById(sectionName + "-arrow");

      if (content.style.display === "none") {
        content.style.display = "block";
        arrow.textContent = "▲";
      } else {
        content.style.display = "none";
        arrow.textContent = "▼";
      }
    }

    // Get current user information
    function getCurrentUser() {
      $.post(
        "/api",
        '{"service":"user","access":"get","command":"get current user"}',
        function (data, status) {
          if (status === "success" && data.username) {
            document.getElementById("username-display").textContent =
              data.username;
          } else {
            document.getElementById("username-display").textContent = "Unknown";
          }
        }
      ).fail(function () {
        document.getElementById("username-display").textContent = "Unknown";
      });
    }
  </script>

  <body
    style="margin: 0px; height: 100%; font-family: Verdana; min-height: 590px"
  >
    <div class="wrapper">
      <div class="element_top">
        <div class="element_top_pic">
          <img
            src="Logo.png"
            style="max-width: 100%; max-height: 100%"
          /><img />
        </div>
        <div style="width: 100%; height: 20%"></div>
        <div style="width: 100%; height: 40%">
          <font color="#ffffff">
            <b style="margin-left: 20px; font-size: 200%; line-height: 25px"
              >ROQSTAR</b
            ><br />
            <b style="margin-left: 20px; font-size: 150%; line-height: 40px"
              >Managed Ethernet Switch</b
            >
          </font>
        </div>
        <div style="width: 100%; height: 40%"></div>
      </div>
      <div class="system_staus_bar">
        <table style="height: 100%; width: 100%">
          <tr>
            <td>
              <table style="width: 100%; font-size: 80%; table-layout: fixed">
                <tr>
                  <td style="width: 12.5%">
                    <b>Power supply:</b>
                  </td>
                  <td id="system_staus_bar_power" style="width: 12.5%"></td>
                  <td style="width: 12.5%">
                    <b>Software:</b>
                  </td>
                  <td id="system_staus_bar_firmware" style="width: 12.5%"></td>
                  <td style="width: 12.5%">
                    <b>Part No.:</b>
                  </td>
                  <td id="system_staus_bar_device" style="width: 12.5%"></td>
                  <td style="width: 12.5%">
                    <b>Config Name:</b>
                  </td>
                  <td id="system_status_bar_cfg_name" style="width: 12.5%"></td>
                </tr>
                <tr>
                  <td>
                    <b>Ignition status:</b>
                  </td>
                  <td id="system_staus_bar_ignition_status"></td>
                  <td>
                    <b>Serial number:</b>
                  </td>
                  <td id="system_staus_bar_serial_nr"></td>
                  <td>
                    <b>Location:</b>
                  </td>
                  <td id="system_staus_bar_location"></td>
                  <td>
                    <b>Config changed:</b>
                  </td>
                  <td id="unsaved_changes"></td>
                </tr>
                <tr>
                  <td>
                    <b>System uptime:</b>
                  </td>
                  <td id="system_staus_bar_uptime"></td>
                  <td>
                    <b>Management MAC:</b>
                  </td>
                  <td id="system_staus_bar_mac"></td>
                  <td id="system_staus_bar_devCFGNOH"></td>
                  <td id="system_staus_bar_devCFGNOB"></td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </div>
      <div class="dashboard_site">
        <div class="dashboard_site_content">
          <a
            class="selsubpoint"
            id="dashboard"
            onclick="navto(this);"
            style="font-size: 100%"
            >Dashboard</a
          >
          <!-- Status Section -->
          <div class="menu-section mt-5">
            <div class="menu-header" onclick="toggleMenuSection('status')">
              <span class="menu-title">Status</span>
              <span class="menu-arrow" id="status-arrow">▼</span>
            </div>
            <div class="menu-content" id="status-content" style="display: none">
              <div class="menu-content-list">
                <a
                  class="subpoint menu-content-item"
                  id="system"
                  onclick="navto(this);"
                  >System
                </a>
                <a
                  class="subpoint menu-content-item"
                  id="m_interfaces"
                  onclick="navto(this);"
                  >Ports
                </a>
                <a
                  class="subpoint menu-content-item"
                  id="Traffic"
                  onclick="navto(this);"
                  >Traffic
                </a>
                <a
                  class="subpoint menu-content-item"
                  id="m_lacp"
                  onclick="navto(this);"
                  >LACP
                </a>
                <a
                  class="subpoint menu-content-item"
                  id="m_dhcp"
                  onclick="navto(this);"
                  >DHCP Leases
                </a>
                <a
                  class="subpoint menu-content-item"
                  id="log"
                  onclick="navto(this);"
                  >Logging</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="ignition_status"
                  onclick="navto(this);"
                  >Ignition</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="status_stp"
                  onclick="navto(this);"
                  >Spanning Tree</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="status_dhcp_client"
                  onclick="navto(this);"
                  >DHCP Client</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="status_lldp"
                  onclick="navto(this);"
                  >LLDP</a
                >
              </div>
            </div>
          </div>

          <!-- Settings Section -->
          <div class="menu-section">
            <div class="menu-header" onclick="toggleMenuSection('settings')">
              <span class="menu-title">Settings</span>
              <span class="menu-arrow" id="settings-arrow">▼</span>
            </div>
            <div
              class="menu-content"
              id="settings-content"
              style="display: none"
            >
              <div class="menu-content-list">
                <a
                  class="subpoint menu-content-item"
                  id="c_system"
                  onclick="navto(this);"
                  >System</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="ignition"
                  onclick="navto(this);"
                >
                  Ignition</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="ports"
                  onclick="navto(this);"
                  >Ports</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="lacp"
                  onclick="navto(this);"
                  >LACP</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="vlan"
                  onclick="navto(this);"
                  >VLAN</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="multicast"
                  onclick="navto(this);"
                  >Multicasts</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="c_ip"
                  onclick="navto(this);"
                  >Management Interfaces</a
                >
                <!--<a class="subpoint menu-content-item" id="routing" onclick="navto(this);">IP Routing</a>-->
                <a
                  class="subpoint menu-content-item"
                  id="qos"
                  onclick="navto(this);"
                  >QoS</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="mirroring"
                  onclick="navto(this);"
                  >Port Mirroring</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="lldp"
                  onclick="navto(this);"
                  >LLDP</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="stp"
                  onclick="navto(this);"
                  >Spanning Tree</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="c_dhcp"
                  onclick="navto(this);"
                  >DHCP Server</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="dhcp_relay"
                  onclick="navto(this);"
                  >DHCP Relay</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="dhcp_inserter"
                  onclick="navto(this);"
                  >DHCP Inserter</a
                >
                <!--<a class="subpoint menu-content-item" id="igmp" onclick="navto(this);">IGMP</a>-->
                <a
                  class="subpoint menu-content-item"
                  id="ntp"
                  onclick="navto(this);"
                  >NTP Client</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="c_rlogging"
                  onclick="navto(this);"
                  >Remote Logging</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="snmp"
                  onclick="navto(this);"
                  >SNMP</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="nat"
                  onclick="navto(this);"
                  >NAT</a
                >
                <a
                  class="subpoint menu-content-item"
                  id="mqtt"
                  onclick="navto(this);"
                  >MQTT</a
                >
                <!--<a class="subpoint menu-content-item" id="firewall" onclick="navto(this);">Firewall</a>-->
                <!--<a class="subpoint menu-content-item" id="fault" onclick="navto(this);">Fault Contact</a>-->
                <!--<a class="subpoint menu-content-item" id="cabletest" onclick="navto(this);">Cable Test</a>-->
              </div>
            </div>
          </div>

          <!-- Maintenance Section -->
          <div class="menu-section">
            <div class="menu-header" onclick="toggleMenuSection('maintenance')">
              <span class="menu-title">Maintenance</span>
              <span class="menu-arrow" id="maintenance-arrow">▼</span>
            </div>
            <div
              class="menu-content"
              id="maintenance-content"
              style="display: none"
            >
              <div class="menu-content-list">
                <a
                  class="subpoint menu-content-item"
                  id="users"
                  onclick="navto(this);"
                  >Users</a
                >
                <div id="prio_settings">
                  <a
                    class="subpoint menu-content-item"
                    id="settings"
                    onclick="navto(this);"
                    >Configuration</a
                  >
                  <a
                    class="subpoint menu-content-item"
                    id="tls"
                    onclick="navto(this);"
                    >User Certificates</a
                  >
                  <a
                    class="subpoint menu-content-item"
                    id="fwupdate"
                    onclick="navto(this);"
                    >Software</a
                  >
                </div>
              </div>
            </div>
          </div>

          <!--<a class="subpoint menu-content-item" id="help" style="font-size: 100%;" onclick="navto(this);"> Help </a>-->
          <br />
          <a
            class="subpoint mt-5"
            id="licenses"
            style="font-size: 100%"
            onclick="navto(this);"
            >Third Party Notices
          </a>

          <div class="logout-section mt-5">
            <span id="current-user" class="current-user"
              >User: <span id="username-display">Loading...</span></span
            >
            <div class="mt-5">
              <button id="logout" style="cursor: pointer">Logout</button>
            </div>
          </div>
        </div>
      </div>

      <div class="main_content">
        <iframe
          id="content_iframe"
          src="dashboard.html"
          width="100%"
          height="100%"
          style="border-width: 0px"
          seamless
        ></iframe>
      </div>
    </div>
  </body>
</html>
